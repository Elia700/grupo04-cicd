name: CD - Despliegue Continuo

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Simular Despliegue
    runs-on: ubuntu-latest

    steps:
      - name: Checkout del código
        uses: actions/checkout@v4

      - name: Configurar Node.js 18
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Instalar dependencias
        run: npm ci

      - name: Preparar aplicación
        run: |
          echo "Preparando la aplicación para despliegue..."
          echo "Proyecto: grupo04-cicd"
          echo "Versión: 1.0.0"
          echo "Rama: ${{ github.ref_name }}"
          echo "Commit: ${{ github.sha }}"

      - name: Verificar aplicación
        run: |
          echo "Verificando la aplicación..."
          node -c index.js
          echo "Aplicación verificada correctamente"

      - name: Simular despliegue
        run: |
          echo "Iniciando proceso de despliegue..."
          echo "Entorno: Producción"
          echo "Servidor: servidor-produccion.ejemplo.com"
          sleep 2
          echo "Subiendo archivos al servidor..."
          sleep 2
          echo "Reiniciando servicios..."
          sleep 1
          echo "Despliegue completado exitosamente"

      - name: Notificación de éxito
        if: success()
        run: |
          echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
          echo "   DESPLIEGUE EXITOSO"
          echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
          echo "Proyecto: grupo04-cicd"
          echo "Versión: 1.0.0"
          echo "Commit: ${{ github.sha }}"
          echo "Autor: ${{ github.actor }}"
          echo "Fecha: $(date)"
          echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

      - name: Notificación de fallo
        if: failure()
        run: |
          echo "El despliegue ha fallado"
          echo "Por favor, revisa los logs anteriores"
