name: CD - Despliegue Continuo

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Simular Despliegue
    runs-on: ubuntu-latest

    steps:
      - name: Checkout del cÃ³digo
        uses: actions/checkout@v4

      - name: Configurar Node.js 18
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Instalar dependencias
        run: npm ci

      - name: Preparar aplicaciÃ³n
        run: |
          echo "ğŸ“¦ Preparando la aplicaciÃ³n para despliegue..."
          echo "Proyecto: grupo04-cicd"
          echo "VersiÃ³n: 1.0.0"
          echo "Rama: ${{ github.ref_name }}"
          echo "Commit: ${{ github.sha }}"

      - name: Verificar aplicaciÃ³n
        run: |
          echo "ğŸ” Verificando la aplicaciÃ³n..."
          node -c index.js
          echo "âœ… AplicaciÃ³n verificada correctamente"

      - name: Simular despliegue
        run: |
          echo "ğŸš€ Iniciando proceso de despliegue..."
          echo "Entorno: ProducciÃ³n"
          echo "Servidor: servidor-produccion.ejemplo.com"
          sleep 2
          echo "ğŸ“¤ Subiendo archivos al servidor..."
          sleep 2
          echo "ğŸ”„ Reiniciando servicios..."
          sleep 1
          echo "âœ… Despliegue completado exitosamente"

      - name: NotificaciÃ³n de Ã©xito
        if: success()
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… DESPLIEGUE EXITOSO"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "Proyecto: grupo04-cicd"
          echo "VersiÃ³n: 1.0.0"
          echo "Commit: ${{ github.sha }}"
          echo "Autor: ${{ github.actor }}"
          echo "Fecha: $(date)"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

      - name: NotificaciÃ³n de fallo
        if: failure()
        run: |
          echo "âŒ El despliegue ha fallado"
          echo "Por favor, revisa los logs anteriores"
